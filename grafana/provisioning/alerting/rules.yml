apiVersion: 1

groups:
  - orgId: 1
    name: production-alerts
    folder: Production Alerts
    interval: 1m
    rules:
      - uid: error-critical-logs
        title: Critical | Error log received
        condition: C
        data:
          - refId: A
            queryType: ""
            relativeTimeRange:
              from: 300
              to: 0
            datasourceUid: P4E55FF30829D8CB1
            model:
              intervalMs: 1000
              maxDataPoints: 43200
              bucketAggs:
                - type: date_histogram
                  field: "@timestamp"
                  id: "2"
                  settings:
                    interval: auto
                    min_doc_count: "0"
                    trimEdges: "0"
              metrics:
                - type: count
                  id: "1"
              query: "environment:docker AND (level:ERROR OR level:CRITICAL)"
              refId: A
              timeField: "@timestamp"
          - refId: B
            queryType: ""
            relativeTimeRange:
              from: 300
              to: 0
            datasourceUid: __expr__
            model:
              conditions:
                - evaluator:
                    params: []
                    type: gt
                  operator:
                    type: and
                  query:
                    params:
                      - B
                  reducer:
                    params: []
                    type: sum
                  type: query
              datasource:
                type: __expr__
                uid: __expr__
              expression: A
              hide: false
              intervalMs: 1000
              maxDataPoints: 43200
              reducer: sum
              refId: B
              settings:
                mode: dropNN
              type: reduce
          - refId: C
            queryType: ""
            relativeTimeRange:
              from: 300
              to: 0
            datasourceUid: __expr__
            model:
              conditions:
                - evaluator:
                    params:
                      - 3
                    type: gt
                  operator:
                    type: and
                  query:
                    params:
                      - C
                  reducer:
                    params: []
                    type: last
                  type: query
              datasource:
                type: __expr__
                uid: __expr__
              expression: $B > 3
              hide: false
              intervalMs: 1000
              maxDataPoints: 43200
              refId: C
              type: math
        noDataState: NoData
        execErrState: Alerting
        for: 30s
        annotations:
          summary: üö® –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ª–æ–≥–∏
          description: –í —Å–∏—Å—Ç–µ–º–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ {{ $values.B.Value }} –ª–æ–≥–æ–≤ —Å —É—Ä–æ–≤–Ω–µ–º ERROR –∏–ª–∏ CRITICAL –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –º–∏–Ω—É—Ç
        labels:
          severity: critical
        isPaused: false

      - uid: http-5xx-errors
        title: HTTP 5xx Errors
        condition: C
        data:
          - refId: A
            queryType: ""
            relativeTimeRange:
              from: 300
              to: 0
            datasourceUid: P4E55FF30829D8CB1
            model:
              intervalMs: 1000
              maxDataPoints: 43200
              bucketAggs:
                - type: date_histogram
                  field: "@timestamp"
                  id: "2"
                  settings:
                    interval: auto
                    min_doc_count: "0"
                    trimEdges: "0"
              metrics:
                - type: count
                  id: "1"
              query: "environment:docker AND http_status:[500 TO 599]"
              refId: A
              timeField: "@timestamp"
          - refId: B
            queryType: ""
            relativeTimeRange:
              from: 300
              to: 0
            datasourceUid: __expr__
            model:
              conditions:
                - evaluator:
                    params: []
                    type: gt
                  operator:
                    type: and
                  query:
                    params:
                      - B
                  reducer:
                    params: []
                    type: sum
                  type: query
              datasource:
                type: __expr__
                uid: __expr__
              expression: A
              hide: false
              intervalMs: 1000
              maxDataPoints: 43200
              reducer: sum
              refId: B
              settings:
                mode: dropNN
              type: reduce
          - refId: C
            queryType: ""
            relativeTimeRange:
              from: 300
              to: 0
            datasourceUid: __expr__
            model:
              conditions:
                - evaluator:
                    params:
                      - 5
                    type: gt
                  operator:
                    type: and
                  query:
                    params:
                      - C
                  reducer:
                    params: []
                    type: last
                  type: query
              datasource:
                type: __expr__
                uid: __expr__
              expression: $B > 5
              hide: false
              intervalMs: 1000
              maxDataPoints: 43200
              refId: C
              type: math
        noDataState: NoData
        execErrState: Alerting
        for: 1m
        annotations:
          summary: ‚ö†Ô∏è HTTP 5xx –æ—à–∏–±–∫–∏
          description: –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ {{ $values.B.Value }} HTTP –æ—Ç–≤–µ—Ç–æ–≤ —Å –∫–æ–¥–æ–º 5xx –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –º–∏–Ω—É—Ç
        labels:
          severity: warning
        isPaused: false

      - uid: slow-response-time
        title: Slow Response Time
        condition: C
        data:
          - refId: A
            queryType: ""
            relativeTimeRange:
              from: 600
              to: 0
            datasourceUid: P4E55FF30829D8CB1
            model:
              intervalMs: 1000
              maxDataPoints: 43200
              bucketAggs:
                - type: date_histogram
                  field: "@timestamp"
                  id: "2"
                  settings:
                    interval: auto
                    min_doc_count: "0"
                    trimEdges: "0"
              metrics:
                - type: count
                  id: "1"
              query: "environment:docker AND response_time:[7 TO *]"
              refId: A
              timeField: "@timestamp"
          - refId: B
            queryType: ""
            relativeTimeRange:
              from: 600
              to: 0
            datasourceUid: __expr__
            model:
              conditions:
                - evaluator:
                    params: []
                    type: gt
                  operator:
                    type: and
                  query:
                    params:
                      - B
                  reducer:
                    params: []
                    type: sum
                  type: query
              datasource:
                type: __expr__
                uid: __expr__
              expression: A
              hide: false
              intervalMs: 1000
              maxDataPoints: 43200
              reducer: sum
              refId: B
              settings:
                mode: dropNN
              type: reduce
          - refId: C
            queryType: ""
            relativeTimeRange:
              from: 600
              to: 0
            datasourceUid: __expr__
            model:
              conditions:
                - evaluator:
                    params:
                      - 10
                    type: gt
                  operator:
                    type: and
                  query:
                    params:
                      - C
                  reducer:
                    params: []
                    type: last
                  type: query
              datasource:
                type: __expr__
                uid: __expr__
              expression: $B > 10
              hide: false
              intervalMs: 1000
              maxDataPoints: 43200
              refId: C
              type: math
        noDataState: NoData
        execErrState: Alerting
        for: 2m
        annotations:
          summary: üêå –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
          description: –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ {{ $values.B.Value }} –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –≤—Ä–µ–º–µ–Ω–µ–º –æ—Ç–≤–µ—Ç–∞ –±–æ–ª–µ–µ 7 —Å–µ–∫—É–Ω–¥ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 –º–∏–Ω—É—Ç
        labels:
          severity: warning
        isPaused: false
