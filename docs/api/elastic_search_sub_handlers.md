# üì¶ Elasticsearch Sub Handlers

## –û–ø–∏—Å–∞–Ω–∏–µ
–í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å –¥–ª—è –±–∞—Ç—á-–∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –≤ Elasticsearch. –°–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –Ω–∞–ø–æ–ª–Ω–µ–Ω–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–µ–π, –≥—Ä—É–ø–ø, –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π –∏ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ PostgreSQL.

## –§—É–Ω–∫—Ü–∏–∏

### üìö `fill_spec_index()`
–ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–µ–π –≤ Elasticsearch.

**–°–∏–≥–Ω–∞—Ç—É—Ä–∞:**
```python
async def fill_spec_index(
    records: list[dict],
    spec_index: str,
    es_obj: AsyncElasticsearch
) -> bool
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `records` (list[dict]) - —Å–ø–∏—Å–æ–∫ –∑–∞–ø–∏—Å–µ–π –∏–∑ –ë–î —Å –ø–æ–ª—è–º–∏ `id`, `spec_code`, `title`
- `spec_index` (str) - –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞ Elasticsearch
- `es_obj` (AsyncElasticsearch) - –∫–ª–∏–µ–Ω—Ç Elasticsearch

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
- `bool` - `True` –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏

**–õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã:**
1. –§–æ—Ä–º–∏—Ä—É–µ—Ç batch –¥–ª—è Bulk API (action + document)
2. –ü—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ 2000 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç batch –≤ Elasticsearch
3. –ü–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Å–µ—Ö –∑–∞–ø–∏—Å–µ–π –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Å—Ç–∞—Ç–æ–∫ –∏ –≤—ã–∑—ã–≤–∞–µ—Ç `refresh=True`
4. –õ–æ–≥–∏—Ä—É–µ—Ç –∫–∞–∂–¥—É—é –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é –ø–∞—Ä—Ç–∏—é

**–ò–Ω–¥–µ–∫—Å–∏—Ä—É–µ–º—ã–µ –ø–æ–ª—è:**
- `code_autocomplete` - –∫–æ–¥ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "09.02.07")
- `title` - –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏

---

### üë• `fill_group_index()`
–ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –≥—Ä—É–ø–ø —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –≤ Elasticsearch.

**–°–∏–≥–Ω–∞—Ç—É—Ä–∞:**
```python
async def fill_group_index(
    records: list[dict],
    group_index: str,
    es_obj: AsyncElasticsearch
) -> bool
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `records` (list[dict]) - —Å–ø–∏—Å–æ–∫ –∑–∞–ø–∏—Å–µ–π –∏–∑ –ë–î —Å –ø–æ–ª—è–º–∏ `id`, `name`, `is_active`
- `group_index` (str) - –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞ Elasticsearch
- `es_obj` (AsyncElasticsearch) - –∫–ª–∏–µ–Ω—Ç Elasticsearch

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
- `bool` - `True` –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏

**–ò–Ω–¥–µ–∫—Å–∏—Ä—É–µ–º—ã–µ –ø–æ–ª—è:**
- `group_name` - –Ω–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, "23–ò1")
- `is_active` - —Å—Ç–∞—Ç—É—Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –≥—Ä—É–ø–ø—ã

---

### üìñ `fill_disciplines_index()`
–ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –¥–∏—Å—Ü–∏–ø–ª–∏–Ω –≤ Elasticsearch.

**–°–∏–≥–Ω–∞—Ç—É—Ä–∞:**
```python
async def fill_disciplines_index(
    records: list[dict],
    disciplines_index: str,
    es_obj: AsyncElasticsearch
) -> bool
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `records` (list[dict]) - —Å–ø–∏—Å–æ–∫ –∑–∞–ø–∏—Å–µ–π –∏–∑ –ë–î —Å –ø–æ–ª—è–º–∏ `id`, `title`, `is_active`
- `disciplines_index` (str) - –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞ Elasticsearch
- `es_obj` (AsyncElasticsearch) - –∫–ª–∏–µ–Ω—Ç Elasticsearch

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
- `bool` - `True` –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏

**–ò–Ω–¥–µ–∫—Å–∏—Ä—É–µ–º—ã–µ –ø–æ–ª—è:**
- `title` - –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞")
- `is_active` - —Å—Ç–∞—Ç—É—Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã

---

### üë®‚Äçüè´ `fill_teachers_index()`
–ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π –≤ Elasticsearch.

**–°–∏–≥–Ω–∞—Ç—É—Ä–∞:**
```python
async def fill_teachers_index(
    records: list[dict],
    teachers_index: str,
    es_obj: AsyncElasticsearch
) -> bool
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `records` (list[dict]) - —Å–ø–∏—Å–æ–∫ –∑–∞–ø–∏—Å–µ–π –∏–∑ –ë–î —Å –ø–æ–ª—è–º–∏ `id`, `fio`, `is_active`
- `teachers_index` (str) - –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞ Elasticsearch
- `es_obj` (AsyncElasticsearch) - –∫–ª–∏–µ–Ω—Ç Elasticsearch

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
- `bool` - `True` –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏

**–ò–Ω–¥–µ–∫—Å–∏—Ä—É–µ–º—ã–µ –ø–æ–ª—è:**
- `fio` - –§–ò–û –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á")
- `is_active` - —Å—Ç–∞—Ç—É—Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è

## –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞

### –ë–∞—Ç—á-–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è

–í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –µ–¥–∏–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω –±–∞—Ç—á-–∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:

1. **–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ batch:**
   - –î–ª—è –∫–∞–∂–¥–æ–π –∑–∞–ø–∏—Å–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è 2 —ç–ª–µ–º–µ–Ω—Ç–∞ –≤ batch:
     - Action: `{'index': {'_index': index_name, '_id': record_id}}`
     - Document: —Å–ª–æ–≤–∞—Ä—å —Å –ø–æ–ª—è–º–∏ –¥–ª—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏

2. **–û—Ç–ø—Ä–∞–≤–∫–∞ –ø–∞—Ä—Ç–∏—è–º–∏:**
   - –ü—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ 2000 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (1000 –∑–∞–ø–∏—Å–µ–π √ó 2 —ç–ª–µ–º–µ–Ω—Ç–∞) batch –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `es_obj.bulk(body=batch)` –¥–ª—è –º–∞—Å—Å–æ–≤–æ–π –≤—Å—Ç–∞–≤–∫–∏
   - –ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ batch –æ—á–∏—â–∞–µ—Ç—Å—è

3. **–§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è:**
   - –û—Å—Ç–∞—Ç–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å `refresh=True`
   - –ï—Å–ª–∏ –æ—Å—Ç–∞—Ç–∫–∞ –Ω–µ—Ç, –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `es_obj.indices.refresh(index=index_name)`
   - Refresh –¥–µ–ª–∞–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç—ã –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –¥–ª—è –ø–æ–∏—Å–∫–∞ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

**–ü–æ—á–µ–º—É 2000 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ batch?**
- –ë–∞–ª–∞–Ω—Å –º–µ–∂–¥—É —Ä–∞–∑–º–µ—Ä–æ–º –∑–∞–ø—Ä–æ—Å–∞ –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º HTTP –≤—ã–∑–æ–≤–æ–≤
- Elasticsearch —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç batch —Ä–∞–∑–º–µ—Ä–æ–º 5-15 MB
- –î–ª—è –Ω–µ–±–æ–ª—å—à–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (2-3 –ø–æ–ª—è) 2000 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ ‚âà 1-2 MB

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ Bulk API:**
- –û–¥–∏–Ω HTTP –∑–∞–ø—Ä–æ—Å –≤–º–µ—Å—Ç–æ —Ç—ã—Å—è—á –æ—Ç–¥–µ–ª—å–Ω—ã—Ö
- –°–Ω–∏–∂–µ–Ω–∏–µ network overhead
- –£—Å–∫–æ—Ä–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –≤ 10-100 —Ä–∞–∑ –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –æ–¥–∏–Ω–æ—á–Ω—ã–º–∏ –≤—Å—Ç–∞–≤–∫–∞–º–∏

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–ö–∞–∂–¥–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ª–æ–≥–∏—Ä—É–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫—É –ø–∞—Ä—Ç–∏–π:
```python
log_event(f'–í –∏–Ω–¥–µ–∫—Å "{index_name}" –∑–∞–ª–µ—Ç–µ–ª–∞ –ø–∞—Ä—Ç–∏—è!', level='WARNING')
```

- –£—Ä–æ–≤–µ–Ω—å `WARNING` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è –≤–∞–∂–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
- –ü–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –≤ –ª–æ–≥–∞—Ö
- –ü–æ–º–æ–≥–∞–µ—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã –ø—Ä–∏ –±–æ–ª—å—à–æ–º –æ–±—ä—ë–º–µ –¥–∞–Ω–Ω—ã—Ö

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

### –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –º–æ–¥—É–ª–∏
- `core.utils.logger.log_event` - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏

### –í–Ω–µ—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- `elasticsearch.AsyncElasticsearch` - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–ª–∏–µ–Ω—Ç Elasticsearch

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–µ–π
```python
from elasticsearch import AsyncElasticsearch
from core.api.elastic_search.sub_handlers import fill_spec_index

# –î–∞–Ω–Ω—ã–µ –∏–∑ –ë–î
records = [
    {'id': 1, 'spec_code': '09.02.07', 'title': '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã'},
    {'id': 2, 'spec_code': '09.02.03', 'title': '–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ'},
    # ... –µ—â—ë –∑–∞–ø–∏—Å–∏
]

# –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è
es_client = AsyncElasticsearch(hosts=['http://localhost:9200'])
success = await fill_spec_index(records, 'specialties_index', es_client)

if success:
    print("–ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ")
```

### –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –≥—Ä—É–ø–ø
```python
from core.api.elastic_search.sub_handlers import fill_group_index

records = [
    {'id': 1, 'name': '23–ò1', 'is_active': True},
    {'id': 2, 'name': '23–ò2', 'is_active': True},
    # ... –µ—â—ë –∑–∞–ø–∏—Å–∏
]

success = await fill_group_index(records, 'groups_index', es_client)
```

### –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
```python
# –í —Ñ—É–Ω–∫—Ü–∏–∏ init_elasticsearch_index()
async with db.acquire() as conn:
    conn = PgSql(conn)
    records_specs = await conn.specialties.specialties2elastic()
    records_groups = await conn.groups.groups2elastic()
    records_teachers = await conn.teachers.teachers2elastic()
    records_disciplines = await conn.disciplines.disciplines2elastic()

# –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –≤—Å–µ—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π
spec_status = await fill_spec_index(records_specs, index_names[1], aioes)
group_status = await fill_group_index(records_groups, index_names[2], aioes)
teachers_status = await fill_teachers_index(records_teachers, index_names[3], aioes)
disciplines_status = await fill_disciplines_index(records_disciplines, index_names[4], aioes)

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏
all_success = spec_status and group_status and teachers_status and disciplines_status
```

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥—Ä—É–≥–∏–º–∏ –º–æ–¥—É–ª—è–º–∏

### –°–≤—è–∑—å —Å api_elastic_search.py
–§—É–Ω–∫—Ü–∏–∏ –≤—ã–∑—ã–≤–∞—é—Ç—Å—è –∏–∑ `init_elasticsearch_index()` –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
- –ü–æ–ª—É—á–∞—é—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ PostgreSQL —á–µ—Ä–µ–∑ –º–µ—Ç–æ–¥—ã `*2elastic()`
- –ò–Ω–¥–µ–∫—Å–∏—Ä—É—é—Ç –¥–∞–Ω–Ω—ã–µ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –∏–Ω–¥–µ–∫—Å—ã
- –í–æ–∑–≤—Ä–∞—â–∞—é—Ç —Å—Ç–∞—Ç—É—Å –¥–ª—è –æ–±—â–µ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏

### –°–≤—è–∑—å —Å PostgreSQL
–§—É–Ω–∫—Ü–∏–∏ –æ–∂–∏–¥–∞—é—Ç –¥–∞–Ω–Ω—ã–µ –≤ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ –∏–∑ –ë–î:
- **Specialties:** `id, spec_code, title`
- **Groups:** `id, name, is_active`
- **Teachers:** `id, fio, is_active`
- **Disciplines:** `id, title, is_active`

### –°–≤—è–∑—å —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
–í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç `log_event()` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞:
- –õ–æ–≥–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ Elasticsearch LogIndex
- –£—Ä–æ–≤–µ–Ω—å WARNING –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏–π –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
- –ü–æ–º–æ–≥–∞–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å —á–µ—Ä–µ–∑ Grafana

## –¢–∏–ø–∏—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

1. **–ü–µ—Ä–≤–∏—á–Ω–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ:**
   - –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å `ES_INIT=true`
   - `init_elasticsearch_index()` –∏–∑–≤–ª–µ–∫–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ –ë–î
   - –í—ã–∑—ã–≤–∞—é—Ç—Å—è –≤—Å–µ 4 —Ñ—É–Ω–∫—Ü–∏–∏ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
   - –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø–∞—Ä—Ç–∏—è–º–∏ –ø–æ 2000 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
   - –ò–Ω–¥–µ–∫—Å—ã –≥–æ—Ç–æ–≤—ã –∫ –ø–æ–∏—Å–∫—É

2. **–ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –±–æ–ª—å—à–æ–≥–æ –æ–±—ä—ë–º–∞ –¥–∞–Ω–Ω—ã—Ö:**
   - –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–∞–µ—Ç 5000 –∑–∞–ø–∏—Å–µ–π —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–µ–π
   - –ü–µ—Ä–≤—ã–µ 1000 –∑–∞–ø–∏—Å–µ–π (2000 —ç–ª–µ–º–µ–Ω—Ç–æ–≤) –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è
   - –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è "–í –∏–Ω–¥–µ–∫—Å –∑–∞–ª–µ—Ç–µ–ª–∞ –ø–∞—Ä—Ç–∏—è!"
   - –°–ª–µ–¥—É—é—â–∏–µ 1000 –∑–∞–ø–∏—Å–µ–π –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è
   - –ü—Ä–æ—Ü–µ—Å—Å –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è –¥–æ –∫–æ–Ω—Ü–∞
   - –û—Å—Ç–∞—Ç–æ–∫ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å refresh=True

3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—É—Å—Ç–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞:**
   - –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–∞–µ—Ç –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ records
   - Batch –æ—Å—Ç–∞—ë—Ç—Å—è –ø—É—Å—Ç—ã–º
   - –í—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ `refresh()` –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω–¥–µ–∫—Å–∞
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è True (—É—Å–ø–µ—à–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ)

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –ú–µ—Ç—Ä–∏–∫–∏ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏

–î–ª—è —Ç–∏–ø–∏—á–Ω—ã—Ö –æ–±—ä—ë–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö:
- **Specialties:** ~14-100 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ ‚Üí 1 batch, ~50-200ms
- **Groups:** ~100-200 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ ‚Üí 1 batch, ~100-300ms
- **Teachers:** ~100-200 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ ‚Üí 1 batch, ~100-300ms
- **Disciplines:** ~100-200 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ ‚Üí 1 batch, ~100-300ms

**–û–±—â–µ–µ –≤—Ä–µ–º—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏:** ~500ms - 1s –¥–ª—è –≤—Å–µ—Ö –∏–Ω–¥–µ–∫—Å–æ–≤

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

1. **Bulk API:** –ú–∞—Å—Å–æ–≤–∞—è –≤—Å—Ç–∞–≤–∫–∞ –≤–º–µ—Å—Ç–æ –æ–¥–∏–Ω–æ—á–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
2. **–ë–∞—Ç—á–∏–Ω–≥:** –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ 2000 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞
3. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ async/await –¥–ª—è –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
4. **–û—Ç–ª–æ–∂–µ–Ω–Ω—ã–π refresh:** Refresh —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

**–¢–µ–∫—É—â–µ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**
- –§—É–Ω–∫—Ü–∏–∏ –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏—è —è–≤–Ω–æ
- –ü—Ä–∏ –æ—à–∏–±–∫–µ Elasticsearch –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –≤—ã—à–µ
- –í—ã–∑—ã–≤–∞—é—â–∏–π –∫–æ–¥ (`init_elasticsearch_index()`) –ª–æ–≥–∏—Ä—É–µ—Ç –æ—à–∏–±–∫–∏

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- –î–æ–±–∞–≤–∏—Ç—å try/except –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–æ–∫
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –¥–µ—Ç–∞–ª–∏ –æ—à–∏–±–æ–∫ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
- –í–æ–∑–≤—Ä–∞—â–∞—Ç—å False –ø—Ä–∏ –Ω–µ—É–¥–∞—á–µ –≤–º–µ—Å—Ç–æ –∏—Å–∫–ª—é—á–µ–Ω–∏—è

## –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

1. **–ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è:**
   - –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä `update_mode` –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `update` action –≤–º–µ—Å—Ç–æ `index`

2. **–ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä:**
   - –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ–Ω—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
   - –ü–æ–ª–µ–∑–Ω–æ –ø—Ä–∏ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –±–æ–ª—å—à–∏—Ö –æ–±—ä—ë–º–æ–≤
   - –ù–∞–ø—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å !`tqdm_loop`!

3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**
   - –î–æ–±–∞–≤–∏—Ç—å retry –ª–æ–≥–∏–∫—É –ø—Ä–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–±–æ—è—Ö
   - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –¥–µ—Ç–∞–ª–∏ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

4. **–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö:**
   - –ü—Ä–æ–≤–µ—Ä—è—Ç—å –Ω–∞–ª–∏—á–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π –ø–µ—Ä–µ–¥ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–µ–π
   - –ü—Ä–æ–ø—É—Å–∫–∞—Ç—å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∑–∞–ø–∏—Å–∏ —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
