# –ú–æ–¥—É–ª—å: main_ui

## –û–ø–∏—Å–∞–Ω–∏–µ

–ú–æ–¥—É–ª—å `main_ui.py` —è–≤–ª—è–µ—Ç—Å—è –æ—Å–Ω–æ–≤–Ω—ã–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–µ—Ä—Å–∏—è–º–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è (timetable versions) –≤ —Å–∏—Å—Ç–µ–º–µ. –ü—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã –º–µ—Ç–æ–¥–∏—Å—Ç–æ–≤ —Å –≤–µ—Ä—Å–∏—è–º–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è - —Å–æ–∑–¥–∞–Ω–∏–µ, –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ —à–∞–±–ª–æ–Ω–æ–≤, –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏, –ø—Ä–æ—Å–º–æ—Ç—Ä –∏ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–π.

–ú–æ–¥—É–ª—å –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `n8n_ui`, —Ç–∞–∫ –∫–∞–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –±—ã–ª —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ n8n.

### –ö–ª—é—á–µ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏

**–¢–∏–ø—ã —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è:**
- `standard` - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ, –≤—ã—Å—Ç—É–ø–∞–µ—Ç –¥–µ—Ñ–æ–ª—Ç–Ω—ã–º –µ—Å–ª–∏ –Ω–µ—Ç –∑–∞–º–µ–Ω. –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å: `building_id, type, schedule_date IS NULL, status_id = 1, is_committed = true`
- `replacements` - —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∑–∞–º–µ–Ω, –≤—Å–µ–≥–¥–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–æ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –¥–∞—Ç—É –∏ –∏–¥—ë—Ç –≤–º–µ—Å—Ç–æ –¥–µ—Ñ–æ–ª—Ç–Ω–æ–≥–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è. –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å: `building_id, type, schedule_date, status_id = 1, is_committed = true`

**–°—Ç–∞—Ç—É—Å—ã –≤–µ—Ä—Å–∏–π —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è:**
- `status_id = 1` (accepted) - –£—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ
- `status_id = 2` (pending) - –í –æ–∂–∏–¥–∞–Ω–∏–∏ (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ —É –º–µ—Ç–æ–¥–∏—Å—Ç–∞)

**–§–ª–∞–≥ –∫–æ–º–º–∏—Ç–∞:**
- `is_committed = true` - "–ø—Ä–æ–¥–æ–≤–∞—è" –≤–µ—Ä—Å–∏—è, –∞–∫—Ç–∏–≤–Ω–∞—è –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- `is_committed = false` - –≤–µ—Ä—Å–∏—è –Ω–µ –∞–∫—Ç–∏–≤–Ω–∞

**–°—Ç–∞—Ç—É—Å—ã –∫–∞—Ä—Ç–æ—á–µ–∫** (–æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –≤ `core.utils.anything.CardsStatesStatuses`):
- `status_id = 1` (accepted) - –£—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ
- `status_id = 2` (edited) - –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–æ
- `status_id = 3` (draft) - –ù–µ —Ç—Ä–æ–≥–∞–ª–∏ (–ø–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º—É)

**Building ID:**
–ù–æ–º–µ—Ä –∫–æ—Ä–ø—É—Å–∞ —É—á–µ–±–Ω–æ–≥–æ –∑–∞–≤–µ–¥–µ–Ω–∏—è (–≤—Å–µ–≥–æ 3 –∫–æ—Ä–ø—É—Å–∞). –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏ –≤–µ—Ä—Å–∏–π —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –¥–ª—è –º–µ—Ç–æ–¥–∏—Å—Ç–æ–≤ –∫–∞–∂–¥–æ–≥–æ –∑–¥–∞–Ω–∏—è.

## –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

### ‚ûï POST /private/n8n_ui/ttable/create

**–û–ø–∏—Å–∞–Ω–∏–µ:** –°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `pending` (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ). –≠—Ç–æ —á–µ—Ä–Ω–æ–≤–∏–∫, –∫–æ—Ç–æ—Ä—ã–π –º–µ—Ç–æ–¥–∏—Å—Ç –±—É–¥–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–µ–¥ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º.

**Middleware:**
- `role_require(Roles.methodist)` - –¢—Ä–µ–±—É–µ—Ç—Å—è —Ä–æ–ª—å –º–µ—Ç–æ–¥–∏—Å—Ç–∞
- `JWTCookieDep` - JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ cookie

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞:** –ù–µ—Ç

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "date": "2024-03-15",
  "type": "standard"
}
```

–ü–æ–ª—è:
- `date` (date | null): –î–∞—Ç–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è. –î–ª—è `standard` –º–æ–∂–µ—Ç –±—ã—Ç—å `null`, –¥–ª—è `replacements` –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ –∏ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω–æ–π (–Ω–µ –≤ –ø—Ä–æ—à–ª–æ–º)
- `type` (Literal['standard', 'replacements']): –¢–∏–ø —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è

**–û—Ç–≤–µ—Ç (200):**
```json
{
  "success": true,
  "message": "–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ",
  "ttable_id": 42
}
```

**–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
- `db.ttable.create()` - –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤–µ—Ä—Å–∏–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –≤ –ë–î
- `log_event()` - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è —Å–æ–∑–¥–∞–Ω–∏—è

**–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞:**
1. –°–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤–∞—è –∑–∞–ø–∏—Å—å –≤–µ—Ä—Å–∏–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:
   - `building_id` - –∏–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞ (–∫–æ—Ä–ø—É—Å –º–µ—Ç–æ–¥–∏—Å—Ç–∞)
   - `date` - –∏–∑ —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–∞
   - `type` - —Ç–∏–ø —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
   - `status` - `TimetableVerStatuses.pending` (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)
   - `user_id` - ID –º–µ—Ç–æ–¥–∏—Å—Ç–∞ –∏–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞
2. –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è —Å–æ–±—ã—Ç–∏–µ —Å –¥–µ—Ç–∞–ª—è–º–∏ —Å–æ–∑–¥–∞–Ω–∏—è
3. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è ID —Å–æ–∑–¥–∞–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏

---

### üì• POST /private/n8n_ui/ttable/std/get_all

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ó–∞–≥—Ä—É–∂–∞–µ—Ç —É—Ä–æ–∫–∏ –∏–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è (`std_ttable`) –∫–∞–∫ —à–∞–±–ª–æ–Ω –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –º–µ—Ç–æ–¥–∏—Å—Ç—É –Ω–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Å –Ω—É–ª—è, –∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–æ—Ç–æ–≤—ã–π —à–∞–±–ª–æ–Ω.

**Middleware:**
- `role_require(Roles.methodist)` - –¢—Ä–µ–±—É–µ—Ç—Å—è —Ä–æ–ª—å –º–µ—Ç–æ–¥–∏—Å—Ç–∞
- `JWTCookieDep` - JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ cookie

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞:** –ù–µ—Ç

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "week_day": 1,
  "ttable_id": 42
}
```

–ü–æ–ª—è:
- `week_day` (int): –î–µ–Ω—å –Ω–µ–¥–µ–ª–∏ (1-6, –≥–¥–µ 1 = –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫, 6 = —Å—É–±–±–æ—Ç–∞). –£—á—ë–±–∞ –ø—Ä–æ—Ö–æ–¥–∏—Ç —Å –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫–∞ –ø–æ —Å—É–±–±–æ—Ç—É
- `ttable_id` (int): ID –≤–µ—Ä—Å–∏–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è, –≤ –∫–æ—Ç–æ—Ä—É—é –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ

**–û—Ç–≤–µ—Ç (200):**
```json
{
  "lessons": [
    {
      "card_hist_id": 2,
      "status_card": 3,
      "id": 1,
      "name": "–ò–°-21-1",
      "position": 1,
      "title": "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞",
      "is_force": false
    }
  ]
}
```

**–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
- `db.n8n_ui.load_std_lessons_as_current()` - –ó–∞–≥—Ä—É–∑–∫–∞ —É—Ä–æ–∫–æ–≤ –∏–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
- `log_event()` - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è –∑–∞–≥—Ä—É–∑–∫–∏

**–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞:**
1. –ó–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —É—Ä–æ–∫–∏ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `std_ttable` –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –¥–Ω—è –Ω–µ–¥–µ–ª–∏
2. –£—Ä–æ–∫–∏ –ø—Ä–∏–≤—è–∑—ã–≤–∞—é—Ç—Å—è –∫ —É–∫–∞–∑–∞–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è (`ttable_id`)
3. –°–æ–∑–¥–∞—é—Ç—Å—è –∑–∞–ø–∏—Å–∏ –≤ –∏—Å—Ç–æ—Ä–∏–∏ –∫–∞—Ä—Ç–æ—á–µ–∫ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "draft" (–Ω–µ —Ç—Ä–æ–≥–∞–ª–∏)
4. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Å–ø–∏—Å–æ–∫ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —É—Ä–æ–∫–æ–≤

---

### üîç POST /private/n8n_ui/ttable/std/check_exists

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Ç–µ–∫—É—â–µ–π —Ä–∞–±–æ—á–µ–π –≤–µ—Ä—Å–∏–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è. –ù–∞—Ö–æ–¥–∏—Ç —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã, —É—á–∏—Ç–µ–ª–µ–π –∏–ª–∏ –≥—Ä—É–ø–ø—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ —É–¥–∞–ª–µ–Ω—ã –∏–ª–∏ –∏–∑–º–µ–Ω–µ–Ω—ã –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞—Ö, –Ω–æ –æ—Å—Ç–∞–ª–∏—Å—å –≤ –≤–µ—Ä—Å–∏–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è.

**Middleware:**
- `role_require(Roles.methodist, Roles.read_all)` - –¢—Ä–µ–±—É–µ—Ç—Å—è —Ä–æ–ª—å –º–µ—Ç–æ–¥–∏—Å—Ç–∞ –∏–ª–∏ read_all
- `JWTCookieDep` - JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ cookie

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞:** –ù–µ—Ç

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "ttable_id": 42
}
```

–ü–æ–ª—è:
- `ttable_id` (int): ID –≤–µ—Ä—Å–∏–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

**–û—Ç–≤–µ—Ç (200):**
```json
{
  "diff_groups": [
    {"name": "–ò–°-21-1"}
  ],
  "diff_teachers": [
    {"fio": "–ò–≤–∞–Ω–æ–≤ –ò.–ò."}
  ],
  "diff_disciplines": [
    {"title": "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞"}
  ]
}
```

**–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
- `db.n8n_ui.check_loaded_std_pairs()` - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö
- `log_event()` - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å —É—Ä–æ–≤–Ω–µ–º WARNING

**–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞:**
1. –°—Ä–∞–≤–Ω–∏–≤–∞—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ –≤ –≤–µ—Ä—Å–∏–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞–º–∏
2. –í—ã—è–≤–ª—è—é—Ç—Å—è –≥—Ä—É–ø–ø—ã, –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–∏ –∏ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã, –∫–æ—Ç–æ—Ä—ã–µ:
   - –ü—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤ –≤–µ—Ä—Å–∏–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
   - –ù–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –∏–ª–∏ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞—Ö
3. –í–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è —Å–ø–∏—Å–∫–∏ —Ä–∞–∑–ª–∏—á–∏–π –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ UI
4. –ú–µ—Ç–æ–¥–∏—Å—Ç –º–æ–∂–µ—Ç —É–≤–∏–¥–µ—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–∞–Ω–Ω—ã–µ –∏ –æ–±–Ω–æ–≤–∏—Ç—å –∏—Ö

---

### üìã POST /private/n8n_ui/ttable/current/get_all

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–æ–ª—É—á–∞–µ—Ç –≤—Å–µ —Ç–µ–∫—É—â–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —É–∫–∞–∑–∞–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–∞—Ä—Ç–æ—á–∫–∏, —É –∫–æ—Ç–æ—Ä—ã—Ö `is_current = true`, —Ç–æ –µ—Å—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–µ—Ä—Å–∏–∏.

**Middleware:**
- `role_require(Roles.methodist, Roles.read_all)` - –¢—Ä–µ–±—É–µ—Ç—Å—è —Ä–æ–ª—å –º–µ—Ç–æ–¥–∏—Å—Ç–∞ –∏–ª–∏ read_all
- `JWTCookieDep` - JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ cookie

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞:** –ù–µ—Ç

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "ttable_id": 42
}
```

–ü–æ–ª—è:
- `ttable_id` (int): ID –≤–µ—Ä—Å–∏–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è

**–û—Ç–≤–µ—Ç (200):**
```json
{
  "lessons": [
    {
      "card_hist_id": 10,
      "status_card": 1,
      "group_id": 2,
      "name": "–ò–°-21-1",
      "position": 1,
      "discipline_id": 5,
      "title": "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞",
      "is_force": false
    }
  ]
}
```

–ü–æ–ª—è –æ—Ç–≤–µ—Ç–∞:
- `card_hist_id` (int): ID –∑–∞–ø–∏—Å–∏ –∏—Å—Ç–æ—Ä–∏–∏ –∫–∞—Ä—Ç–æ—á–∫–∏
- `status_card` (int): –°—Ç–∞—Ç—É—Å –∫–∞—Ä—Ç–æ—á–∫–∏ (1 = —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ, 2 = —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–æ, 3 = –Ω–µ —Ç—Ä–æ–≥–∞–ª–∏)
- `group_id` (int): ID –≥—Ä—É–ø–ø—ã
- `name` (str): –ù–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã
- `position` (int): –ù–æ–º–µ—Ä –ø–∞—Ä—ã (–ø–æ–∑–∏—Ü–∏—è —É—Ä–æ–∫–∞)
- `discipline_id` (int): ID –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã
- `title` (str): –ù–∞–∑–≤–∞–Ω–∏–µ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã
- `is_force` (bool): –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ (–ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—é –≤–µ—Å—Ç–∏ 2+ –≥—Ä—É–ø–ø—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ)

**–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
- `db.n8n_ui.get_cards()` - –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–µ–∫ –≤–µ—Ä—Å–∏–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
- `log_event()` - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤–µ—Ä—Å–∏–∏

**–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞:**
1. –ò–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –≤—Å–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —É–∫–∞–∑–∞–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
2. –§–∏–ª—å—Ç—Ä—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ç–µ–∫—É—â–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ (`is_current = true`)
3. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –ø–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–∞–∂–¥–æ–π –∫–∞—Ä—Ç–æ—á–∫–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ UI

---

### ‚úÖ PUT /private/n8n_ui/ttable/versions/pre-commit

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤–µ—Ä—Å–∏–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º. –í—ã–ø–æ–ª–Ω—è–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—é —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –∏ –ø—Ä–æ–≤–µ—Ä–∫—É –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –∞–∫—Ç–∏–≤–Ω—ã–º–∏ –≤–µ—Ä—Å–∏—è–º–∏.

**Middleware:**
- `role_require(Roles.methodist)` - –¢—Ä–µ–±—É–µ—Ç—Å—è —Ä–æ–ª—å –º–µ—Ç–æ–¥–∏—Å—Ç–∞
- `JWTCookieDep` - JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ cookie

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞:** –ù–µ—Ç

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "ttable_id": 42
}
```

–ü–æ–ª—è:
- `ttable_id` (int): ID –≤–µ—Ä—Å–∏–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

**–û—Ç–≤–µ—Ç (200) - –£—Å–ø–µ—à–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞:**
```json
{
  "success": true,
  "message": "Timetable version ready for commit"
}
```

**–û—Ç–≤–µ—Ç (202) - –ö–æ–Ω—Ñ–ª–∏–∫—Ç —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –≤–µ—Ä—Å–∏–µ–π:**
```json
{
  "success": false,
  "message": "Conflicts detected in timetable version",
  "needed_groups": [],
  "ttable_id": 42,
  "cur_active_ver": 35,
  "pending_ver_id": 42
}
```

**–û—Ç–≤–µ—Ç (409) - –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫–∞—Ä—Ç–æ—á–µ–∫:**
```json
{
  "success": false,
  "message": "Missing groups in timetable version",
  "needed_groups": ["–ò–°-21-1", "–ü–†-21-2"],
  "ttable_id": 42
}
```

**–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
- `db.ttable.check_accept_constraints()` - –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –¥–ª—è —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
- `create_ttable_precommit_response()` - –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
- `create_response_json()` - –°–æ–∑–¥–∞–Ω–∏–µ JSON –æ—Ç–≤–µ—Ç–∞ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Å—Ç–∞—Ç—É—Å-–∫–æ–¥–æ–º

**–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞:**

**–°—Ç–∞—Ç—É—Å 200 (—É—Å–ø–µ—Ö):**
- –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —Å–º–µ–Ω–∏–ª–æ `status_id` –Ω–∞ 1 (—É—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ)
- –í—Å–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –≥—Ä—É–ø–ø—ã –∏–º–µ—é—Ç `status_id` –ª–∏–±–æ 1 (—É—Ç–≤–µ—Ä–∂–¥—ë–Ω), –ª–∏–±–æ 3 (–ø–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º—É)
- `ttable_id` —Å—Ä–∞–∑—É –ø–æ–ª—É—á–∞–µ—Ç `is_committed = true`
- –í–µ—Ä—Å–∏—è –≥–æ—Ç–æ–≤–∞ –∫ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏

**–°—Ç–∞—Ç—É—Å 202 (–∫–æ–Ω—Ñ–ª–∏–∫—Ç —Å –∞–∫—Ç–∏–≤–Ω–æ–π –≤–µ—Ä—Å–∏–µ–π):**
- –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Å–º–µ–Ω–∏–ª–æ —Å—Ç–∞—Ç—É—Å –Ω–∞ 1, –Ω–æ –µ—Å—Ç—å –¥—Ä—É–≥–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Å —Ç–∞–∫–∏–º–∏ –∂–µ –∫–ª—é—á–µ–≤—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:
  - `building_id`, `type`, `schedule_date`
  - `is_committed = true` –∏ `status_id = 1`
- –ú–æ–∂–µ—Ç –±—ã—Ç—å —Å–∫–æ–ª—å–∫–æ —É–≥–æ–¥–Ω–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π —Å `status_id = 1`, –Ω–æ —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ –º–æ–∂–µ—Ç –±—ã—Ç—å `status_id = 1 AND is_committed = true`
- –¢—Ä–µ–±—É–µ—Ç—Å—è —è–≤–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `/versions/commit`

**–°—Ç–∞—Ç—É—Å 409 (–Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫–∞—Ä—Ç–æ—á–µ–∫):**
- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤–µ—Ä—Å–∏–∏ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º
- –ö–∞–∫–∞—è-—Ç–æ –∏–∑ `card_hist_id` –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —É—Å–ª–æ–≤–∏—è–º (–Ω–µ –≤—Å–µ –≥—Ä—É–ø–ø—ã –∏–º–µ—é—Ç –∫–∞—Ä—Ç–æ—á–∫–∏ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º 1 –∏–ª–∏ 3)
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Å–ø–∏—Å–æ–∫ –≥—Ä—É–ø–ø, –¥–ª—è –∫–æ—Ç–æ—Ä—ã—Ö –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∏–ª–∏ —É—Ç–≤–µ—Ä–¥–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫–∏

---

### üöÄ PUT /private/n8n_ui/ttable/versions/commit

**–û–ø–∏—Å–∞–Ω–∏–µ:** –£—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –≤–µ—Ä—Å–∏—é —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è, –¥–µ–ª–∞—è –µ—ë –∞–∫—Ç–∏–≤–Ω–æ–π ("–ø—Ä–æ–¥–æ–≤–æ–π"). –ê—Ç–æ–º–∞—Ä–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç —Ñ–ª–∞–≥ `is_committed` –º–µ–∂–¥—É –≤–µ—Ä—Å–∏—è–º–∏ - –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∞–∫—Ç–∏–≤–Ω–æ–π, –ø—Ä–µ–¥—ã–¥—É—â–∞—è –¥–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è.

**Middleware:**
- `role_require(Roles.methodist)` - –¢—Ä–µ–±—É–µ—Ç—Å—è —Ä–æ–ª—å –º–µ—Ç–æ–¥–∏—Å—Ç–∞
- `JWTCookieDep` - JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ cookie

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞:** –ù–µ—Ç

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "pending_ver_id": 42,
  "target_ver_id": 35
}
```

–ü–æ–ª—è:
- `pending_ver_id` (int): ID –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏, –∫–æ—Ç–æ—Ä–∞—è —Å—Ç–∞–Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π
- `target_ver_id` (int): ID —Ç–µ–∫—É—â–µ–π –∞–∫—Ç–∏–≤–Ω–æ–π –≤–µ—Ä—Å–∏–∏, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞

**–û—Ç–≤–µ—Ç (200):**
```json
{
  "success": true,
  "message": "–í–µ—Ä—Å–∏–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω—ã!"
}
```

**–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
- `db.ttable.commit_version()` - –ê—Ç–æ–º–∞—Ä–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–π
- `log_event()` - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–µ—Ä—Å–∏–π

**–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞:**
1. –ü–µ—Ä–µ–¥–∞—ë—Ç—Å—è "—ç—Å—Ç–∞—Ñ–µ—Ç–∞" –º–µ–∂–¥—É –≤–µ—Ä—Å–∏—è–º–∏:
   - `pending_ver_id` –ø–æ–ª—É—á–∞–µ—Ç `is_committed = true` (—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è "–ø—Ä–æ–¥–æ–≤–æ–π")
   - `target_ver_id` –ø–æ–ª—É—á–∞–µ—Ç `is_committed = false` (–¥–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è)
2. –û–ø–µ—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ CTE (Common Table Expression), —á—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å
3. –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è —Å–æ–±—ã—Ç–∏–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Å ID –æ–±–µ–∏—Ö –≤–µ—Ä—Å–∏–π
4. –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∞–∫—Ç–∏–≤–Ω–æ–π –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ —Å–∏—Å—Ç–µ–º–µ

---

### ‚Ü©Ô∏è PUT /private/n8n_ui/ttable/versions/switch_as_pending

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –≤–µ—Ä—Å–∏–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –æ–±—Ä–∞—Ç–Ω–æ –Ω–∞ "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–æ" (`pending`). –ü–æ–∑–≤–æ–ª—è–µ—Ç –º–µ—Ç–æ–¥–∏—Å—Ç—É –≤–µ—Ä–Ω—É—Ç—å —É—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é –≤ —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –≤–Ω–µ—Å–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∫–∞—Ä—Ç–æ—á–∫–∏.

**Middleware:**
- `role_require(Roles.methodist)` - –¢—Ä–µ–±—É–µ—Ç—Å—è —Ä–æ–ª—å –º–µ—Ç–æ–¥–∏—Å—Ç–∞
- `JWTCookieDep` - JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ cookie

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞:** –ù–µ—Ç

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "ttable_id": 42
}
```

–ü–æ–ª—è:
- `ttable_id` (int): ID –≤–µ—Ä—Å–∏–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è

**–û—Ç–≤–µ—Ç (200) - –£—Å–ø–µ—Ö:**
```json
{
  "success": true,
  "message": "–í–µ—Ä—Å–∏—è –∏–∑–º–µ–Ω–∏–ª–∞ —Å—Ç–∞—Ç—É—Å –Ω–∞ \"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–æ\""
}
```

**–û—Ç–≤–µ—Ç (403) - –û—à–∏–±–∫–∞:**
```json
{
  "detail": "–ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –≤–µ—Ä—Å–∏–∏, –û–Ω–∞ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞!"
}
```

**–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
- `db.ttable.switch_ver_status()` - –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –≤–µ—Ä—Å–∏–∏
- `log_event()` - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è (—É—Å–ø–µ—Ö –∏–ª–∏ –æ—à–∏–±–∫–∞)
- `HTTPException` - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è HTTP –æ—à–∏–±–∫–∏ –ø—Ä–∏ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è

**–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞:**
1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –≤–µ—Ä—Å–∏–∏:
   - –í–µ—Ä—Å–∏—è –¥–æ–ª–∂–Ω–∞ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç—å –∫–æ—Ä–ø—É—Å—É –º–µ—Ç–æ–¥–∏—Å—Ç–∞ (`building_id`)
   - –í–µ—Ä—Å–∏—è –Ω–µ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å "–ø—Ä–æ–¥–æ–≤–æ–π" (`is_committed = true`)
2. –ï—Å–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ –ø—Ä–æ–π–¥–µ–Ω–∞:
   - –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ —Å –¥–µ—Ç–∞–ª—è–º–∏
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è HTTP 403 —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º –æ–± –æ—à–∏–±–∫–µ
3. –ï—Å–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–π–¥–µ–Ω–∞:
   - –°—Ç–∞—Ç—É—Å –≤–µ—Ä—Å–∏–∏ –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ `pending` (–≤ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏)
   - –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ
   - –ú–µ—Ç–æ–¥–∏—Å—Ç –º–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ä—Ç–æ—á–∫–∏ –≤–µ—Ä—Å–∏–∏

---

## –§—É–Ω–∫—Ü–∏–∏

–ú–æ–¥—É–ª—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã (route handlers), –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç. –í—Å—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —á–µ—Ä–µ–∑ –≤—ã–∑–æ–≤—ã –º–µ—Ç–æ–¥–æ–≤ —Å–ª–æ—è –¥–∞–Ω–Ω—ã—Ö (`db.*`) –∏ —É—Ç–∏–ª–∏—Ç.

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

### –í–Ω–µ—à–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
- `fastapi` - –§—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è API
  - `APIRouter` - –†–æ—É—Ç–µ—Ä –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
  - `Depends` - –°–∏—Å—Ç–µ–º–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
  - `HTTPException` - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è HTTP –æ—à–∏–±–æ–∫
- `starlette.requests.Request` - –û–±—ä–µ–∫—Ç HTTP –∑–∞–ø—Ä–æ—Å–∞

### –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –º–æ–¥—É–ª–∏

**–°–ª–æ–π –¥–∞–Ω–Ω—ã—Ö:**
- `core.data.postgre.PgSqlDep` - –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ PostgreSQL

**Response —Å—Ö–µ–º—ã:**
- `core.response_schemas.n8n_ui` - –°—Ö–µ–º—ã –æ—Ç–≤–µ—Ç–æ–≤ –¥–ª—è —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤:
  - `TtableCreateResponse` - –û—Ç–≤–µ—Ç —Å–æ–∑–¥–∞–Ω–∏—è –≤–µ—Ä—Å–∏–∏
  - `StdTtableGetAllResponse` - –û—Ç–≤–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
  - `StdTtableCheckExistsResponse` - –û—Ç–≤–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏
  - `CurrentTtableGetAllResponse` - –û—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—É—â–∏—Ö –∫–∞—Ä—Ç–æ—á–µ–∫
- `core.response_schemas.ttable_versions_tab.TtableVersionsCommitResponse` - –û—Ç–≤–µ—Ç –∫–æ–º–º–∏—Ç–∞ –≤–µ—Ä—Å–∏–∏

**Request —Å—Ö–µ–º—ã:**
- `core.schemas.cookie_settings_schema.JWTCookieDep` - JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ cookie
- `core.schemas.n8n_ui.ttable_needs_schema` - –°—Ö–µ–º—ã –∑–∞–ø—Ä–æ—Å–æ–≤:
  - `CreateTtableSchema` - –°–æ–∑–¥–∞–Ω–∏–µ –≤–µ—Ä—Å–∏–∏
  - `StdTtableSchema` - –ë–∞–∑–æ–≤–∞—è —Å—Ö–µ–º–∞ —Å ttable_id
  - `SnapshotTtableSchema` - –°—Ö–µ–º–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–Ω–∏–º–∫–∞
  - `StdTtableLoadSchema` - –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
- `core.schemas.ttable_schema` - –°—Ö–µ–º—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≤–µ—Ä—Å–∏—è–º–∏:
  - `CommitTtableVersionSchema` - –ö–æ–º–º–∏—Ç –≤–µ—Ä—Å–∏–∏
  - `PreAcceptTimetableSchema` - –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

**–£—Ç–∏–ª–∏—Ç—ã:**
- `core.utils.anything` - –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏—è:
  - `Roles` - –†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (methodist, read_all)
  - `TimetableVerStatuses` - –°—Ç–∞—Ç—É—Å—ã –≤–µ—Ä—Å–∏–π —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
- `core.utils.lite_dependencies.role_require` - Middleware –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–æ–ª–µ–π
- `core.utils.logger.log_event` - –§—É–Ω–∫—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏–π
- `core.utils.response_model_utils` - –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–æ–≤:
  - `TtableVersionsPreCommitSuccessResponse` - –£—Å–ø–µ—à–Ω—ã–π pre-commit
  - `TtableVersionsPreCommitConflictResponse` - –ö–æ–Ω—Ñ–ª–∏–∫—Ç –ø—Ä–∏ pre-commit
  - `create_ttable_precommit_response` - –§–∞–±—Ä–∏–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤ pre-commit
  - `create_response_json` - –°–æ–∑–¥–∞–Ω–∏–µ JSON –æ—Ç–≤–µ—Ç–∞

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### HTTP 403 Forbidden
**–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `PUT /ttable/versions/switch_as_pending`

**–ü—Ä–∏—á–∏–Ω–∞:** –ü–æ–ø—ã—Ç–∫–∞ –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –≤–µ—Ä—Å–∏–∏, –∫–æ—Ç–æ—Ä–∞—è:
- –ù–µ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –∫–æ—Ä–ø—É—Å—É –º–µ—Ç–æ–¥–∏—Å—Ç–∞
- –Ø–≤–ª—è–µ—Ç—Å—è "–ø—Ä–æ–¥–æ–≤–æ–π" (`is_committed = true`)

**–û—Ç–≤–µ—Ç:**
```json
{
  "detail": "–ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –≤–µ—Ä—Å–∏–∏, –û–Ω–∞ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞!"
}
```

**–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:** –°–æ–±—ã—Ç–∏–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è —Å —É—Ä–æ–≤–Ω–µ–º WARNING —Å –¥–µ—Ç–∞–ª—è–º–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –∏ –≤–µ—Ä—Å–∏–∏

### –°—Ç–∞—Ç—É—Å-–∫–æ–¥—ã pre-commit

**200 OK:** –í–µ—Ä—Å–∏—è –≥–æ—Ç–æ–≤–∞ –∫ –∫–æ–º–º–∏—Ç—É, –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã

**202 Accepted:** –í–µ—Ä—Å–∏—è –≤–∞–ª–∏–¥–Ω–∞, –Ω–æ –µ—Å—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∞–∫—Ç–∏–≤–Ω–æ–π –≤–µ—Ä—Å–∏–µ–π. –¢—Ä–µ–±—É–µ—Ç—Å—è —è–≤–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `/versions/commit`

**409 Conflict:** –í–µ—Ä—Å–∏—è –Ω–µ –≥–æ—Ç–æ–≤–∞ –∫ –∫–æ–º–º–∏—Ç—É - –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –≥—Ä—É–ø–ø –∏–ª–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ –∏–º–µ—é—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã

## –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

### –†–æ–ª–∏ –∏ –¥–æ—Å—Ç—É–ø

**–†–æ–ª—å `methodist`:**
- –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º –æ–ø–µ—Ä–∞—Ü–∏—è–º —Å –≤–µ—Ä—Å–∏—è–º–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
- –ú–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å, —É—Ç–≤–µ—Ä–∂–¥–∞—Ç—å –≤–µ—Ä—Å–∏–∏
- –†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å–æ —Å–≤–æ–∏–º –∫–æ—Ä–ø—É—Å–æ–º (`building_id`)

**–†–æ–ª—å `read_all`:**
- –†–æ–ª—å –¥–ª—è –∞–¥–º–∏–Ω–∫–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- –ü–æ–∑–≤–æ–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ —á–∏—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ
- –ó–∞–ø—Ä–µ—â–∞–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å –ª—é–±—ã–µ —Ä–µ—Å—É—Ä—Å—ã –≤ `/private` –ø–æ–¥-–∞–¥—Ä–µ—Å–µ URL
- –î–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤: `/ttable/std/check_exists`, `/ttable/current/get_all`

### –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ (is_force)

–§–ª–∞–≥ `is_force` –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±–æ–π—Ç–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞ –ë–î, –∫–æ—Ç–æ—Ä–æ–µ –∑–∞–ø—Ä–µ—â–∞–µ—Ç –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—é –≤–µ—Å—Ç–∏ 2 –∏ –±–æ–ª–µ–µ –≥—Ä—É–ø–ø—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ (–≤ –æ–¥–∏–Ω —É—Ä–æ–∫ –ø–æ –≤—Ä–µ–º–µ–Ω–∏). –ö–æ–≥–¥–∞ `is_force = true`, –∏–Ω–¥–µ–∫—Å –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–Ω—É—é –∑–∞–ø–∏—Å—å, –ø–æ–∑–≤–æ–ª—è—è –Ω–∞–∑–Ω–∞—á–∏—Ç—å –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—é –Ω–µ—Å–∫–æ–ª—å–∫–æ –≥—Ä—É–ø–ø –≤ –æ–¥–Ω–æ –≤—Ä–µ–º—è.

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å –ø–æ–º–æ—â—å—é `log_event()` —Å —Ü–≤–µ—Ç–æ–≤—ã–º –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ–º –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ —á—Ç–µ–Ω–∏—è:
- `\033[36m` (cyan) - ID –≤–µ—Ä—Å–∏–π —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
- `\033[34m` (blue) - –¢–∏–ø—ã —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
- `\033[35m` (magenta) - –î–∞—Ç—ã
- `\033[33m` (yellow) - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `\033[31m` (red) - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–∑–ª–∏—á–∏–π (diff)
- `\033[32m` (green) - ID —Ü–µ–ª–µ–≤—ã—Ö –≤–µ—Ä—Å–∏–π

### –°–≤—è–∑—å —Å –¥—Ä—É–≥–∏–º–∏ –º–æ–¥—É–ª—è–º–∏

**ext_card.py:**
–ú–æ–¥—É–ª—å `main_ui` —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –≤–µ—Ä—Ö–Ω–µ–º —É—Ä–æ–≤–Ω–µ (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏—è–º–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è), –∞ `ext_card` –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é —Ä–∞–±–æ—Ç—É —Å –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏ –≤–Ω—É—Ç—Ä–∏ –≤–µ—Ä—Å–∏–∏. –¢–∏–ø–∏—á–Ω—ã–π workflow:
1. `main_ui`: –°–æ–∑–¥–∞—Ç—å –≤–µ—Ä—Å–∏—é —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
2. `main_ui`: –ó–∞–≥—Ä—É–∑–∏—Ç—å —à–∞–±–ª–æ–Ω –∏–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
3. `ext_card`: –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏
4. `main_ui`: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
5. `main_ui`: –í—ã–ø–æ–ª–Ω–∏—Ç—å pre-commit –ø—Ä–æ–≤–µ—Ä–∫—É
6. `main_ui`: –£—Ç–≤–µ—Ä–¥–∏—Ç—å –≤–µ—Ä—Å–∏—é (commit)

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°–æ–∑–¥–∞–Ω–∏–µ –∏ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è

```python
# 1. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –∑–∞–º–µ–Ω
POST /private/n8n_ui/ttable/create
{
  "date": "2024-03-15",
  "type": "replacements"
}
# –û—Ç–≤–µ—Ç: {"success": true, "message": "–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ", "ttable_id": 42}

# 2. –ó–∞–≥—Ä—É–∑–∏—Ç—å —à–∞–±–ª–æ–Ω –∏–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –¥–ª—è –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫–∞
POST /private/n8n_ui/ttable/std/get_all
{
  "week_day": 1,
  "ttable_id": 42
}
# –û—Ç–≤–µ—Ç: {"lessons": [...]}

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
POST /private/n8n_ui/ttable/std/check_exists
{
  "ttable_id": 42
}
# –û—Ç–≤–µ—Ç: {"diff_groups": [], "diff_teachers": [], "diff_disciplines": []}

# 4. –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–µ—Ä—Å–∏–∏
POST /private/n8n_ui/ttable/current/get_all
{
  "ttable_id": 42
}
# –û—Ç–≤–µ—Ç: {"lessons": [...]}

# 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
PUT /private/n8n_ui/ttable/versions/pre-commit
{
  "ttable_id": 42
}
# –û—Ç–≤–µ—Ç (202): {"success": false, "cur_active_ver": 35, "pending_ver_id": 42}

# 6. –£—Ç–≤–µ—Ä–¥–∏—Ç—å –≤–µ—Ä—Å–∏—é (–ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Å —Ç–µ–∫—É—â–µ–π –∞–∫—Ç–∏–≤–Ω–æ–π)
PUT /private/n8n_ui/ttable/versions/commit
{
  "pending_ver_id": 42,
  "target_ver_id": 35
}
# –û—Ç–≤–µ—Ç: {"success": true, "message": "–í–µ—Ä—Å–∏–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω—ã!"}
```

### –í–æ–∑–≤—Ä–∞—Ç –≤–µ—Ä—Å–∏–∏ –≤ —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```python
# –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —É—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é –æ–±—Ä–∞—Ç–Ω–æ –≤ pending
PUT /private/n8n_ui/ttable/versions/switch_as_pending
{
  "ttable_id": 42
}
# –û—Ç–≤–µ—Ç: {"success": true, "message": "–í–µ—Ä—Å–∏—è –∏–∑–º–µ–Ω–∏–ª–∞ —Å—Ç–∞—Ç—É—Å –Ω–∞ \"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–æ\""}

# –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ä—Ç–æ—á–∫–∏ —á–µ—Ä–µ–∑ ext_card —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
```
