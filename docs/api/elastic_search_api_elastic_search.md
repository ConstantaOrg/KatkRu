# üîç Elasticsearch Search API

## –û–ø–∏—Å–∞–Ω–∏–µ
–ú–æ–¥—É–ª—å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç API –¥–ª—è –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ —Ä–∞–∑–ª–∏—á–Ω—ã–º —Å—É—â–Ω–æ—Å—Ç—è–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ Elasticsearch. –í–∫–ª—é—á–∞–µ—Ç –ø—É–±–ª–∏—á–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è –ø–æ–∏—Å–∫–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–µ–π –∏ –≥—Ä—É–ø–ø, –∞ —Ç–∞–∫–∂–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫ –¥–ª—è –º–µ—Ç–æ–¥–∏—Å—Ç–æ–≤.

## –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

### üìù POST `/api/v1/public/elastic/autocomplete_spec`
–ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–µ–π –¥–ª—è –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è (autocomplete).

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "search_term": "–ø—Ä–æ–≥—Ä",
  "search_mode": "auto"
}
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `search_term` (str) - –ø–æ–∏—Å–∫–æ–≤–∞—è —Ñ—Ä–∞–∑–∞
- `search_mode` (Literal["auto", "deep"]) - —Ä–µ–∂–∏–º –ø–æ–∏—Å–∫–∞:
  - `"auto"` - –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —Å edge n-gram —Ç–æ–∫–µ–Ω–∏–∑–∞—Ü–∏–µ–π (prefix matching)
  - `"deep"` - –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ —Å fuzziness

**–û—Ç–≤–µ—Ç 200:**
```json
{
  "search_res": [
    {
      "id": "1",
      "spec_code": "09.02.07",
      "title": "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã –∏ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ"
    },
    {
      "id": "2",
      "spec_code": "09.02.03",
      "title": "–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö"
    }
  ]
}
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–æ 5 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- –ü–æ–∏—Å–∫ –ø–æ –∫–æ–¥—É —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏ (boost=3) –∏ –Ω–∞–∑–≤–∞–Ω–∏—é (boost=2)
- –†–µ–∂–∏–º "auto" –∏—Å–ø–æ–ª—å–∑—É–µ—Ç edge n-gram –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è

---

### üîé POST `/api/v1/public/elastic/ext_spec`
–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–µ–π —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π.

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "search_term": "–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ",
  "search_mode": "deep",
  "limit": 10,
  "offset": 0
}
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `search_term` (str) - –ø–æ–∏—Å–∫–æ–≤–∞—è —Ñ—Ä–∞–∑–∞
- `search_mode` (Literal["auto", "deep"]) - —Ä–µ–∂–∏–º –ø–æ–∏—Å–∫–∞
- `limit` (int, default=10) - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- `offset` (int, default=0) - —Å–º–µ—â–µ–Ω–∏–µ –¥–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏

**–û—Ç–≤–µ—Ç 200:**
```json
{
  "search_res": [
    {
      "id": "1",
      "spec_code": "09.02.07",
      "title": "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã –∏ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ"
    },
    {
      "id": "2",
      "spec_code": "09.02.03",
      "title": "–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö"
    }
  ]
}
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–∞–≥–∏–Ω–∞—Ü–∏—é
- –†–µ–∂–∏–º "deep" –∏—Å–ø–æ–ª—å–∑—É–µ—Ç multi_match —Å fuzziness –¥–ª—è –Ω–µ—á—ë—Ç–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞
- –ü–æ–∏—Å–∫ –ø–æ –∫–æ–¥—É (boost=2) –∏ –Ω–∞–∑–≤–∞–Ω–∏—é —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏

---

### üë• POST `/api/v1/public/elastic/search_group`
–ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ –≥—Ä—É–ø–ø –¥–ª—è –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è.

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "search_term": "23–ò"
}
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `search_term` (str) - –ø–æ–∏—Å–∫–æ–≤–∞—è —Ñ—Ä–∞–∑–∞ (–Ω–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã)

**–û—Ç–≤–µ—Ç 200:**
```json
{
  "search_res": [
    {
      "id": "1",
      "group_name": "23–ò1"
    },
    {
      "id": "2",
      "group_name": "23–ò2"
    }
  ]
}
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–æ 10 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç edge n-gram —Ç–æ–∫–µ–Ω–∏–∑–∞—Ü–∏—é –¥–ª—è –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è
- –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –≥—Ä—É–ø–ø—ã —Å uppercase —Ñ–∏–ª—å—Ç—Ä–æ–º

---

### üîê POST `/api/v1/private/elastic/methodist_search`
–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫ –¥–ª—è –º–µ—Ç–æ–¥–∏—Å—Ç–æ–≤ –ø–æ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è–º, –≥—Ä—É–ø–ø–∞–º –∏ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞–º.

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- –†–æ–ª—å: `methodist` –∏–ª–∏ `read_all`
- JWT —Ç–æ–∫–µ–Ω –≤ cookie

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "search_tab": "teachers",
  "search_phrase": "–ò–≤–∞–Ω–æ–≤",
  "limit": 20,
  "offset": 0
}
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `search_tab` (Literal["teachers", "groups", "disciplines"]) - —Ç–∏–ø —Å—É—â–Ω–æ—Å—Ç–∏ –¥–ª—è –ø–æ–∏—Å–∫–∞
- `search_phrase` (str) - –ø–æ–∏—Å–∫–æ–≤–∞—è —Ñ—Ä–∞–∑–∞
- `limit` (int, default=10) - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- `offset` (int, default=0) - —Å–º–µ—â–µ–Ω–∏–µ –¥–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏

**–û—Ç–≤–µ—Ç 200 (–¥–ª—è teachers):**
```json
{
  "search_res": [
    {
      "id": 1,
      "fio": "–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á",
      "is_active": true
    },
    {
      "id": 2,
      "fio": "–ò–≤–∞–Ω–æ–≤–∞ –ú–∞—Ä–∏—è –ü–µ—Ç—Ä–æ–≤–Ω–∞",
      "is_active": true
    }
  ]
}
```

**–û—Ç–≤–µ—Ç 200 (–¥–ª—è groups):**
```json
{
  "search_res": [
    {
      "id": 1,
      "group_name": "23–ò1",
      "is_active": true
    }
  ]
}
```

**–û—Ç–≤–µ—Ç 200 (–¥–ª—è disciplines):**
```json
{
  "search_res": [
    {
      "id": 1,
      "title": "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞",
      "is_active": true
    }
  ]
}
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è —Ç—Ä—ë—Ö —Ç–∏–ø–æ–≤ —Å—É—â–Ω–æ—Å—Ç–µ–π
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ UI —Å —Ç–∞–±–∞–º–∏ (–≤–∫–ª–∞–¥–∫–∞–º–∏) –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ–∂–¥—É —Ç–∏–ø–∞–º–∏ –ø–æ–∏—Å–∫–∞
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–∞–≥–∏–Ω–∞—Ü–∏—é
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –≥–ª—É–±–æ–∫–∏–π –ø–æ–∏—Å–∫ —Å fuzziness –¥–ª—è –Ω–µ—á—ë—Ç–∫–æ–≥–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
- –õ–æ–≥–∏—Ä—É–µ—Ç user_id –¥–ª—è –∞—É–¥–∏—Ç–∞ –¥–µ–π—Å—Ç–≤–∏–π –º–µ—Ç–æ–¥–∏—Å—Ç–∞

## –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞

### –†–µ–∂–∏–º—ã –ø–æ–∏—Å–∫–∞

**–†–µ–∂–∏–º "auto" (–∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ):**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç edge n-gram —Ç–æ–∫–µ–Ω–∏–∑–∞—Ü–∏—é (min_gram=2, max_gram=8-10)
- –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ –ø–æ –ø—Ä–µ—Ñ–∏–∫—Å—É
- –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è autocomplete –ø–æ–ª–µ–π –≤ UI
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –∫–æ–¥ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏ (boost=3) > –Ω–∞–∑–≤–∞–Ω–∏–µ (boost=2)

**–†–µ–∂–∏–º "deep" (–ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π):**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç standard —Ç–æ–∫–µ–Ω–∏–∑–∞—Ü–∏—é —Å fuzziness="AUTO"
- –ù–µ—á—ë—Ç–∫–∏–π –ø–æ–∏—Å–∫ —Å —É—á—ë—Ç–æ–º –æ–ø–µ—á–∞—Ç–æ–∫
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–æ–∏—Å–∫ –ø–æ —á–∞—Å—Ç–∏—á–Ω—ã–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è–º
- Prefix_length=1 –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –ò–Ω–¥–µ–∫—Å—ã Elasticsearch

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç 5 –∏–Ω–¥–µ–∫—Å–æ–≤:

1. **Specialties Index** (`env.search_index_spec`)
   - –ü–æ–ª—è: `code_autocomplete`, `title`
   - –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä—ã: code_autocomplete, title_autocomplete, deep_search
   - –†–∞–∑–º–µ—Ä: ~14-100 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

2. **Groups Index** (`env.search_index_group`)
   - –ü–æ–ª—è: `group_name`, `is_active`
   - –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä—ã: group_autocomplete, fulltext_search
   - –†–∞–∑–º–µ—Ä: ~100-200 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

3. **Teachers Index** (`env.search_index_teachers`)
   - –ü–æ–ª—è: `fio`, `is_active`
   - –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä: fulltext_search
   - –†–∞–∑–º–µ—Ä: ~100-200 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

4. **Disciplines Index** (`env.search_index_discip`)
   - –ü–æ–ª—è: `title`, `is_active`
   - –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä: fulltext_search
   - –†–∞–∑–º–µ—Ä: ~100-200 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

5. **Logs Index** (`env.log_index`)
   - –ü–æ–ª—è: timestamp, level, message, –º–µ—Ç—Ä–∏–∫–∏ CPU/RAM –∏ –¥—Ä.
   - ILM –ø–æ–ª–∏—Ç–∏–∫–∞: hot(7d) ‚Üí warm(7d) ‚Üí cold(30d) ‚Üí delete(90d)
   - Rollover: max_size=1GB, max_age=7d, max_docs=1M

### –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤

–§—É–Ω–∫—Ü–∏—è `init_elasticsearch_index()` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–≤ lifespan), –µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è `ES_INIT=true`.

**–ü—Ä–æ—Ü–µ—Å—Å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:**

1. **–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ë–î:**
   - –í—ã–∑—ã–≤–∞—é—Ç—Å—è –º–µ—Ç–æ–¥—ã `*2elastic()` –¥–ª—è –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü—ã
   - –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ PostgreSQL

2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏:**
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞ —á–µ—Ä–µ–∑ alias
   - –ï—Å–ª–∏ –∏–Ω–¥–µ–∫—Å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è

3. **–°–æ–∑–¥–∞–Ω–∏–µ ILM –ø–æ–ª–∏—Ç–∏–∫–∏** (—Ç–æ–ª—å–∫–æ –¥–ª—è LogIndex):
   - –ü–æ–ª–∏—Ç–∏–∫–∞ `app-logs-policy` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Ä–æ—Ç–∞—Ü–∏–∏ –ª–æ–≥–æ–≤
   - Hot phase: rollover –ø—Ä–∏ 1GB/7d/1M docs
   - Warm phase (7d): forcemerge, 0 replicas
   - Cold phase (30d): —Å–Ω–∏–∂–µ–Ω–∏–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞
   - Delete phase (90d): —É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –ª–æ–≥–æ–≤

4. **–°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤:**
   - –°–æ–∑–¥–∞—é—Ç—Å—è –∏–Ω–¥–µ–∫—Å—ã —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –∏–∑ `core/config_dir/index_settings.py`
   - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è aliases, settings, mappings
   - `refresh_interval="-1"` –¥–ª—è —Å—Ç–∞—Ç–∏—á–Ω—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤ (–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è)

5. **–ë–∞—Ç—á-–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è:**
   - –î–∞–Ω–Ω—ã–µ –≤—Å—Ç–∞–≤–ª—è—é—Ç—Å—è –ø–∞–∫–µ—Ç–∞–º–∏ –ø–æ 2000 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Bulk API –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
   - –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `refresh=True`

**–°—Ç–∞—Ç—É—Å –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏:**
- –í—Å–µ –∏–Ω–¥–µ–∫—Å—ã –∫—Ä–æ–º–µ LogIndex —Å—Ç–∞—Ç–∏—á–Ω—ã (–Ω–µ—Ç auto-refresh)
- –ò–Ω–¥–µ–∫—Å—ã —Å–æ–¥–µ—Ä–∂–∞—Ç —Å–Ω–∏–º–æ–∫ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –º–æ–º–µ–Ω—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- ‚ö†Ô∏è **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ:** –ù–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å –ë–î –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö –∑–∞–ø–∏—Å–µ–π

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

### –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –º–æ–¥—É–ª–∏
- `core.api.elastic_search.sub_handlers` - —Ñ—É–Ω–∫—Ü–∏–∏ –±–∞—Ç—á-–∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
- `core.config_dir.config.ElasticDep` - dependency injection –¥–ª—è AsyncElasticsearch
- `core.config_dir.index_settings` - –∫–ª–∞—Å—Å—ã –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏–Ω–¥–µ–∫—Å–æ–≤ (SpecIndex, GroupIndex –∏ –¥—Ä.)
- `core.data.postgre.PgSql` - —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å PostgreSQL
- `core.schemas.cookie_settings_schema.JWTCookieDep` - –≤–∞–ª–∏–¥–∞—Ü–∏—è JWT —Ç–æ–∫–µ–Ω–∞
- `core.utils.lite_dependencies.role_require` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `core.utils.logger.log_event` - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–∏—Å–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

### –í–Ω–µ—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- `elasticsearch.AsyncElasticsearch` - –∫–ª–∏–µ–Ω—Ç Elasticsearch
- `asyncpg.Pool` - –ø—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π PostgreSQL

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

**–ú–µ—Ç–æ–¥—ã –¥–ª—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏:**
- `conn.specialties.specialties2elastic()` - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `id, spec_code, title`
- `conn.groups.groups2elastic()` - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `id, name, is_active`
- `conn.teachers.teachers2elastic()` - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `id, fio, is_active`
- `conn.disciplines.disciplines2elastic()` - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `id, title, is_active`

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ê–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–µ–π
```bash
curl -X POST "http://localhost:8000/api/v1/public/elastic/autocomplete_spec" \
  -H "Content-Type: application/json" \
  -d '{
    "search_term": "–ø—Ä–æ–≥",
    "search_mode": "auto"
  }'
```

### –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
```bash
curl -X POST "http://localhost:8000/api/v1/public/elastic/ext_spec" \
  -H "Content-Type: application/json" \
  -d '{
    "search_term": "–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ",
    "search_mode": "deep",
    "limit": 10,
    "offset": 0
  }'
```

### –ü–æ–∏—Å–∫ –≥—Ä—É–ø–ø
```bash
curl -X POST "http://localhost:8000/api/v1/public/elastic/search_group" \
  -H "Content-Type: application/json" \
  -d '{
    "search_term": "23–ò"
  }'
```

### –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫ –º–µ—Ç–æ–¥–∏—Å—Ç–∞
```bash
curl -X POST "http://localhost:8000/api/v1/private/elastic/methodist_search" \
  -H "Content-Type: application/json" \
  -H "Cookie: access_token=<JWT_TOKEN>" \
  -d '{
    "search_tab": "teachers",
    "search_phrase": "–ò–≤–∞–Ω–æ–≤",
    "limit": 20,
    "offset": 0
  }'
```

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥—Ä—É–≥–∏–º–∏ –º–æ–¥—É–ª—è–º–∏

### –°–≤—è–∑—å —Å sub_handlers.py
–ú–æ–¥—É–ª—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ `sub_handlers.py` –¥–ª—è –±–∞—Ç—á-–∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏:
- `fill_spec_index()` - –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–µ–π
- `fill_group_index()` - –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –≥—Ä—É–ø–ø
- `fill_teachers_index()` - –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π
- `fill_disciplines_index()` - –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –¥–∏—Å—Ü–∏–ø–ª–∏–Ω

### –°–≤—è–∑—å —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
–í—Å–µ –ø–æ–∏—Å–∫–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å –¥–µ—Ç–∞–ª—è–º–∏:
- –ü–æ–∏—Å–∫–æ–≤–∞—è —Ñ—Ä–∞–∑–∞ –∏ —Ä–µ–∂–∏–º –ø–æ–∏—Å–∫–∞
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- IP –∞–¥—Ä–µ—Å –∏ user_id (–¥–ª—è –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤)
- –õ–æ–≥–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ Elasticsearch LogIndex –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### –°–≤—è–∑—å —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π
–ü—Ä–∏–≤–∞—Ç–Ω—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç `/methodist_search` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç:
- `JWTCookieDep` –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ç–æ–∫–µ–Ω–∞
- `role_require(Roles.methodist, Roles.read_all)` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
- `request.state.user_id` –¥–ª—è –∞—É–¥–∏—Ç–∞ –¥–µ–π—Å—Ç–≤–∏–π

## –¢–∏–ø–∏—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

1. **–ü–æ–∏—Å–∫ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏ –∞–±–∏—Ç—É—Ä–∏–µ–Ω—Ç–æ–º:**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç "–ø—Ä–æ–≥" –≤ –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞
   - –§—Ä–æ–Ω—Ç–µ–Ω–¥ –≤—ã–∑—ã–≤–∞–µ—Ç `/autocomplete_spec` —Å mode="auto"
   - –û—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –ø–µ—Ä–≤—ã–µ 5 —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –≤—ã–±–æ—Ä–∞

2. **–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–µ–π:**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –ø–æ–ª–Ω—ã–π –∑–∞–ø—Ä–æ—Å "–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω—ã—Ö —Å–∏—Å—Ç–µ–º"
   - –§—Ä–æ–Ω—Ç–µ–Ω–¥ –≤—ã–∑—ã–≤–∞–µ—Ç `/ext_spec` —Å mode="deep"
   - Elasticsearch –Ω–∞—Ö–æ–¥–∏—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è —Å —É—á—ë—Ç–æ–º –æ–ø–µ—á–∞—Ç–æ–∫ (fuzziness)
   - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π

3. **–ü–æ–∏—Å–∫ –≥—Ä—É–ø–ø—ã –º–µ—Ç–æ–¥–∏—Å—Ç–æ–º:**
   - –ú–µ—Ç–æ–¥–∏—Å—Ç –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç UI —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
   - –í —Ç–∞–±–µ "–ì—Ä—É–ø–ø—ã" –≤–≤–æ–¥–∏—Ç "23–ò"
   - –í—ã–∑—ã–≤–∞–µ—Ç—Å—è `/methodist_search` —Å tab="groups"
   - –û—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤—Å–µ –≥—Ä—É–ø–ø—ã, –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å "23–ò"

4. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ:**
   - –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å `ES_INIT=true`
   - –í lifespan –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `init_elasticsearch_index()`
   - –°–æ–∑–¥–∞—é—Ç—Å—è –≤—Å–µ –∏–Ω–¥–µ–∫—Å—ã –∏ ILM –ø–æ–ª–∏—Ç–∏–∫–∞
   - –î–∞–Ω–Ω—ã–µ –∏–∑ –ë–î –∏–Ω–¥–µ–∫—Å–∏—Ä—É—é—Ç—Å—è –±–∞—Ç—á–∞–º–∏
   - –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ –∫ –ø–æ–∏—Å–∫—É

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ –±—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### ‚ö†Ô∏è –¢–µ–∫—É—â–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:**
   - –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–π –≥—Ä—É–ø–ø—ã/—É—á–∏—Ç–µ–ª—è/–¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã –≤ –ë–î, –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ–ø–∞–¥–∞—é—Ç –≤ Elasticsearch –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
   - –¢—Ä–µ–±—É–µ—Ç—Å—è —Ä—É—á–Ω–∞—è –ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –∏–ª–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å `ES_INIT=true`

2. **–ü–æ–ª–µ `is_active` –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**
   - –ò–Ω–¥–µ–∫—Å—ã —Å–æ–¥–µ—Ä–∂–∞—Ç –ø–æ–ª–µ `is_active`, –Ω–æ –æ–Ω–æ –Ω–µ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –ø–æ–∏—Å–∫–µ
   - –ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö

3. **–°—Ç–∞—Ç–∏—á–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã:**
   - `refresh_interval="-1"` –æ–∑–Ω–∞—á–∞–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
   - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–≥–æ refresh

### üöÄ –ü–ª–∞–Ω–∏—Ä—É–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

1. **–ú–µ—Ö–∞–Ω–∏–∑–º –ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏:**
   - –î–æ–±–∞–≤–∏—Ç—å —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è —Ä—É—á–Ω–æ–π –ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –≤ –ë–î

2. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ `is_active`:**
   - –î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä –≤ –ø–æ–∏—Å–∫–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π

3. **Real-time —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å CDC (Change Data Capture) –∏–ª–∏ triggers –≤ PostgreSQL
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è—Ç—å Elasticsearch –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –≤ –ë–î

## –¢–µ–≥–∏
`Searchüîç` - –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –≤ Swagger UI –¥–ª—è —É–¥–æ–±–Ω–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ API.
